{% extends "base.html" %}

{% block title %}HackTJ Ops · Dashboard{% endblock %}

{% block content %}
  <section class="hero">
    <div style="display:flex; justify-content:space-between; flex-wrap:wrap; gap:1.25rem;">
      <div>
        <p class="muted">blah blah</p>
        <h1 style="margin-bottom:0.4rem;">blah blah</h1>
        <p class="muted">blah blah</p>
      </div>
      <div>
        <p class="muted">blah blah</p>
        <div class="pill">{{ role_display }}</div>
        {% if team %}
          <p class="muted" style="margin-top:0.35rem;">blah blah</p>
        {% endif %}
      </div>
    </div>
  </section>

  <div class="grid two">
    <section class="card">
      <h2>Basic event info</h2>
      <ul style="margin:0; padding-left:1.25rem;">
        {% for item in basic_event_info %}
          <li><strong>{{ item.label }}:</strong> {{ item.value }}</li>
        {% endfor %}
      </ul>
      {% if site_content and site_content.wifi_name %}
        <div style="margin-top:1rem; padding:0.75rem; border:1px dashed #d3d3d3; border-radius:0.5rem; background:#fff;">
          <strong>Wi‑Fi</strong>
          <div><span class="muted">Network:</span> {{ site_content.wifi_name }}</div>
          {% if site_content.wifi_password %}
            <div><span class="muted">Password:</span> {{ site_content.wifi_password }}</div>
          {% endif %}
        </div>
      {% endif %}
    </section>

    <section class="card">
      <h2>Announcements</h2>
      <p class="muted">blah blah</p>
    </section>
  </div>

  <section class="card">
    <h2>Useful links</h2>
    <p class="muted">blah blah</p>
  </section>

  {% if site_content %}
    <section class="card">
      <h2>Additional updates</h2>
      {% if site_content.additional_all %}
        <iframe
          title="Additional updates"
          src="{{ site_content.additional_all.url }}"
          style="width:100%; height:320px; border:1px solid #d3d3d3; border-radius:0.5rem;"
        ></iframe>
      {% else %}
        <p class="muted">No additional updates right now.</p>
      {% endif %}
    </section>

    {% if role == "team" and site_content.additional_team %}
      <section class="card">
        <h2>Team updates</h2>
        <iframe
          title="Team updates"
          src="{{ site_content.additional_team.url }}"
          style="width:100%; height:320px; border:1px solid #d3d3d3; border-radius:0.5rem;"
        ></iframe>
      </section>
    {% endif %}

    {% if role == "judge" and site_content.additional_judge %}
      <section class="card">
        <h2>Judge updates</h2>
        <iframe
          title="Judge updates"
          src="{{ site_content.additional_judge.url }}"
          style="width:100%; height:320px; border:1px solid #d3d3d3; border-radius:0.5rem;"
        ></iframe>
      </section>
    {% endif %}

    {% if role == "hacktj" and site_content.additional_hacktj %}
      <section class="card">
        <h2>HackTJ team updates</h2>
        <iframe
          title="HackTJ team updates"
          src="{{ site_content.additional_hacktj.url }}"
          style="width:100%; height:320px; border:1px solid #d3d3d3; border-radius:0.5rem;"
        ></iframe>
      </section>
    {% endif %}

    {% if role == "admin" and site_content.additional_admin %}
      <section class="card">
        <h2>Admin updates</h2>
        <iframe
          title="Admin updates"
          src="{{ site_content.additional_admin.url }}"
          style="width:100%; height:320px; border:1px solid #d3d3d3; border-radius:0.5rem;"
        ></iframe>
      </section>
    {% endif %}

    {% if role == "volunteer" and site_content.additional_volunteer %}
      <section class="card">
        <h2>Volunteer updates</h2>
        <iframe
          title="Volunteer updates"
          src="{{ site_content.additional_volunteer.url }}"
          style="width:100%; height:320px; border:1px solid #d3d3d3; border-radius:0.5rem;"
        ></iframe>
      </section>
    {% endif %}
  {% endif %}

  <section class="card">
    <h2>Schedule &amp; deadlines</h2>
    <p class="muted">blah blah</p>
  </section>

  {% if show_forms %}
    <section class="card">
      <h2>Forms &amp; submissions</h2>
      <p class="muted">blah blah</p>
    </section>
  {% endif %}

  {% if show_project_sections %}
    <div class="grid two">
      <section class="card">
        <h2>Project snapshot</h2>
        <p class="muted">blah blah</p>
      </section>

      <section class="card">
        <h2>Presentation slides</h2>
        {% if presentation %}
          <p class="muted">One submission per team. Google Slides links only.</p>
          <div style="display:flex; flex-direction:column; gap:0.75rem;">
            {% if presentation.link_url %}
              <div>
                <strong>Public link</strong>
                <div style="margin-top:0.35rem;">
                  <a class="btn" href="{{ presentation.link_url }}" target="_blank" rel="noopener">Open slides</a>
                </div>
              </div>
              {% if presentation_embed_url %}
                <div style="border:1px solid #d3d3d3; border-radius:0.5rem; overflow:hidden;">
                  <iframe
                    src="{{ presentation_embed_url }}"
                    title="Presentation slides"
                    style="width:100%; height:420px; border:0;"
                    allowfullscreen
                  ></iframe>
                </div>
              {% else %}
                <p class="muted">Only Google Slides links are supported for preview.</p>
              {% endif %}
            {% endif %}
            <div class="card" style="background:#fff;">
              <h3 style="margin-bottom:0.5rem;">Presentation timer</h3>
              <div id="timer-display" style="font-size:1.6rem; font-weight:700;">00:00</div>
              <div style="display:flex; gap:0.5rem; margin-top:0.75rem;">
                <button type="button" id="timer-start">Start</button>
                <button type="button" id="timer-pause">Pause</button>
                <button type="button" id="timer-reset">Reset</button>
              </div>
            </div>
          </div>
        {% else %}
          <p class="muted">No slides submitted yet. Add a Google Slides link or upload a .pptx/.pdf file.</p>
        {% endif %}
      </section>
    </div>
  {% endif %}

  {% if show_judging %}
    <section class="card">
      <h2>Judging appointments</h2>
      <p class="muted">blah blah</p>
    </section>
  {% endif %}

  {% if show_food_team or show_food_ops or show_category_section %}
    <div class="grid two">
      {% if show_food_team %}
        <section class="card">
          <h2>Food check-in</h2>
          <p class="muted">blah blah</p>
        </section>
      {% elif show_food_ops %}
        <section class="card">
          <h2>Food check-in</h2>
          <p class="muted">blah blah</p>
        </section>
      {% endif %}

      {% if show_category_section %}
        <section class="card">
          <h2>Category submission checklist</h2>
          <p class="muted">blah blah</p>
        </section>
      {% endif %}
    </div>
  {% endif %}

  {% if show_master_projects %}
    <section class="card">
      <h2>Master project list</h2>
      <p class="muted">blah blah</p>
    </section>
  {% endif %}

  {% if show_integrity or show_scoreboard %}
    <div class="grid two">
      {% if show_integrity %}
        <section class="card">
          <h2>Integrity reports</h2>
          <p class="muted">blah blah</p>
        </section>
      {% endif %}

      {% if show_scoreboard %}
        <section class="card">
          <h2>Scoreboard</h2>
          <p class="muted">blah blah</p>
        </section>
      {% endif %}
    </div>
  {% endif %}

  {% if show_admin_panel %}
    <section class="card">
      <h2>Admin panel / SQL console</h2>
      <p class="muted">blah blah</p>
    </section>
  {% endif %}

  <script>
    (function () {
      const display = document.getElementById("timer-display");
      if (!display) return;

      const startBtn = document.getElementById("timer-start");
      const pauseBtn = document.getElementById("timer-pause");
      const resetBtn = document.getElementById("timer-reset");

      let startTime = null;
      let elapsed = 0;
      let rafId = null;

      const formatTime = (ms) => {
        const totalSeconds = Math.floor(ms / 1000);
        const minutes = String(Math.floor(totalSeconds / 60)).padStart(2, "0");
        const seconds = String(totalSeconds % 60).padStart(2, "0");
        return `${minutes}:${seconds}`;
      };

      const tick = (now) => {
        if (startTime === null) return;
        const current = elapsed + (now - startTime);
        display.textContent = formatTime(current);
        rafId = requestAnimationFrame(tick);
      };

      startBtn?.addEventListener("click", () => {
        if (startTime !== null) return;
        startTime = performance.now();
        rafId = requestAnimationFrame(tick);
      });

      pauseBtn?.addEventListener("click", () => {
        if (startTime === null) return;
        elapsed += performance.now() - startTime;
        startTime = null;
        if (rafId) cancelAnimationFrame(rafId);
        display.textContent = formatTime(elapsed);
      });

      resetBtn?.addEventListener("click", () => {
        startTime = null;
        elapsed = 0;
        if (rafId) cancelAnimationFrame(rafId);
        display.textContent = "00:00";
      });
    })();
  </script>
{% endblock %}
